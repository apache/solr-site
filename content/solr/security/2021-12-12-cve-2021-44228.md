Title: Apache Solr affected by Apache Log4J CVE-2021-44228
category: solr/security
cve: CVE-2021-44228

**Severity:**
Critical

**Versions Affected:**
7.0.0 to 7.7.3
8.0.0 to 8.11.0

**Description:**
Apache Solr releases prior to 8.11.1 were using a bundled version of the Apache Log4J library vulnerable to RCE. For full impact and additional detail consult the Log4J security page.

Apache Solr releases prior to 7.0 (i.e. all Solr 5 and Solr 6 releases) use log4j 1.2.17 which may be vulnerable for installations using non-default logging configurations. To determine you if you are vulnerable please consult the Log4J security page.

The Prometheus Exporter Contrib is similarly separately affected.

**Mitigation:**
Any of the following are enough to prevent this vulnerability for Solr servers:

* Upgrade to `Solr 8.11.1` or greater (when available), which will include an updated version of the log4j2 dependency.
* Manually update the version of log4j2 on your runtime classpath and restart your Solr application.
* (Linux/MacOS) Edit your `solr.in.sh` file to include:
  `SOLR_OPTS="$SOLR_OPTS -Dlog4j2.formatMsgNoLookups=true"`
* (Windows) Edit your `solr.in.cmd` file to include:
  `set SOLR_OPTS=%SOLR_OPTS% -Dlog4j2.formatMsgNoLookups=true`
* Follow any of the other mitgations listed at https://logging.apache.org/log4j/2.x/security.html

The vulnerability in the Prometheus Exporter Contrib can be mitigated by any of the following:

* Upgrade to `Solr 8.11.1` or greater (when available), which will include an updated version of the log4j2 dependency.
* Manually update the version of log4j2 on your runtime classpath and restart your Solr application.
* Edit your `solr-exporter` script to include
  `JAVA_OPTS="$JAVA_OPTS -Dlog4j2.formatMsgNoLookups=true"`
* Follow any of the other mitgations listed at https://logging.apache.org/log4j/2.x/security.html

**References:**
https://logging.apache.org/log4j/2.x/security.html
